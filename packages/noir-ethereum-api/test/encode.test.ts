import { describe, expect, it } from 'vitest';
import { decodeField, decodeHexAddress, encodeBytes32 } from '../src/noir/encode.js';

describe('encodeBytes32', () => {
  it('zero', () => {
    expect(encodeBytes32(0n)).toStrictEqual([
      '0x0',
      '0x0',
      '0x0',
      '0x0',
      '0x0',
      '0x0',
      '0x0',
      '0x0',
      '0x0',
      '0x0',
      '0x0',
      '0x0',
      '0x0',
      '0x0',
      '0x0',
      '0x0',
      '0x0',
      '0x0',
      '0x0',
      '0x0',
      '0x0',
      '0x0',
      '0x0',
      '0x0',
      '0x0',
      '0x0',
      '0x0',
      '0x0',
      '0x0',
      '0x0',
      '0x0',
      '0x0'
    ]);
  });

  it('one', () => {
    expect(encodeBytes32(1n)).toStrictEqual([
      '0x0',
      '0x0',
      '0x0',
      '0x0',
      '0x0',
      '0x0',
      '0x0',
      '0x0',
      '0x0',
      '0x0',
      '0x0',
      '0x0',
      '0x0',
      '0x0',
      '0x0',
      '0x0',
      '0x0',
      '0x0',
      '0x0',
      '0x0',
      '0x0',
      '0x0',
      '0x0',
      '0x0',
      '0x0',
      '0x0',
      '0x0',
      '0x0',
      '0x0',
      '0x0',
      '0x0',
      '0x1'
    ]);
  });

  it('4 bytes number', () => {
    expect(encodeBytes32(3000000019n)).toStrictEqual([
      '0x0',
      '0x0',
      '0x0',
      '0x0',
      '0x0',
      '0x0',
      '0x0',
      '0x0',
      '0x0',
      '0x0',
      '0x0',
      '0x0',
      '0x0',
      '0x0',
      '0x0',
      '0x0',
      '0x0',
      '0x0',
      '0x0',
      '0x0',
      '0x0',
      '0x0',
      '0x0',
      '0x0',
      '0x0',
      '0x0',
      '0x0',
      '0x0',
      '0xb2',
      '0xd0',
      '0x5e',
      '0x13'
    ]);
  });

  it('MAX_INT_256', () => {
    expect(encodeBytes32(2n ** 256n - 1n)).toStrictEqual([
      '0xff',
      '0xff',
      '0xff',
      '0xff',
      '0xff',
      '0xff',
      '0xff',
      '0xff',
      '0xff',
      '0xff',
      '0xff',
      '0xff',
      '0xff',
      '0xff',
      '0xff',
      '0xff',
      '0xff',
      '0xff',
      '0xff',
      '0xff',
      '0xff',
      '0xff',
      '0xff',
      '0xff',
      '0xff',
      '0xff',
      '0xff',
      '0xff',
      '0xff',
      '0xff',
      '0xff',
      '0xff'
    ]);
  });

  it('throws if negative value', () => {
    expect(() => encodeBytes32(-1n)).toThrow('Invalid Bytes32: Negative');
  });

  it('throws if overflows', () => {
    expect(() => encodeBytes32(2n ** 256n)).toThrow('Invalid Bytes32: Overflow');
  });
});

describe('decodeHexAddress', () => {
  it('success', () => {
    const arg = [
      '0x0000000000000000000000000000000000000000000000000000000000000030',
      '0x0000000000000000000000000000000000000000000000000000000000000078',
      '0x0000000000000000000000000000000000000000000000000000000000000065',
      '0x0000000000000000000000000000000000000000000000000000000000000039',
      '0x0000000000000000000000000000000000000000000000000000000000000063',
      '0x0000000000000000000000000000000000000000000000000000000000000033',
      '0x0000000000000000000000000000000000000000000000000000000000000031',
      '0x0000000000000000000000000000000000000000000000000000000000000032',
      '0x0000000000000000000000000000000000000000000000000000000000000033',
      '0x0000000000000000000000000000000000000000000000000000000000000065',
      '0x0000000000000000000000000000000000000000000000000000000000000034',
      '0x0000000000000000000000000000000000000000000000000000000000000063',
      '0x0000000000000000000000000000000000000000000000000000000000000066',
      '0x0000000000000000000000000000000000000000000000000000000000000033',
      '0x0000000000000000000000000000000000000000000000000000000000000034',
      '0x0000000000000000000000000000000000000000000000000000000000000038',
      '0x0000000000000000000000000000000000000000000000000000000000000063',
      '0x0000000000000000000000000000000000000000000000000000000000000036',
      '0x0000000000000000000000000000000000000000000000000000000000000036',
      '0x0000000000000000000000000000000000000000000000000000000000000062',
      '0x0000000000000000000000000000000000000000000000000000000000000032',
      '0x0000000000000000000000000000000000000000000000000000000000000030',
      '0x0000000000000000000000000000000000000000000000000000000000000061',
      '0x0000000000000000000000000000000000000000000000000000000000000039',
      '0x0000000000000000000000000000000000000000000000000000000000000038',
      '0x0000000000000000000000000000000000000000000000000000000000000035',
      '0x0000000000000000000000000000000000000000000000000000000000000061',
      '0x0000000000000000000000000000000000000000000000000000000000000066',
      '0x0000000000000000000000000000000000000000000000000000000000000032',
      '0x0000000000000000000000000000000000000000000000000000000000000036',
      '0x0000000000000000000000000000000000000000000000000000000000000034',
      '0x0000000000000000000000000000000000000000000000000000000000000038',
      '0x0000000000000000000000000000000000000000000000000000000000000039',
      '0x0000000000000000000000000000000000000000000000000000000000000031',
      '0x0000000000000000000000000000000000000000000000000000000000000066',
      '0x0000000000000000000000000000000000000000000000000000000000000063',
      '0x0000000000000000000000000000000000000000000000000000000000000030',
      '0x0000000000000000000000000000000000000000000000000000000000000061',
      '0x0000000000000000000000000000000000000000000000000000000000000034',
      '0x0000000000000000000000000000000000000000000000000000000000000034',
      '0x0000000000000000000000000000000000000000000000000000000000000031',
      '0x0000000000000000000000000000000000000000000000000000000000000061'
    ];
    expect(decodeHexAddress(arg)).toBe('0xe9c3123e4cf348c66b20a985af264891fc0a441a');
  });
});

describe('decodeField', () => {
  it('success', () => {
    expect(decodeField('0x0')).toEqual(0n);
    expect(decodeField('0x0000')).toEqual(0n);
    expect(decodeField('0x1')).toEqual(1n);
    expect(decodeField('0xff')).toEqual(255n);
    expect(decodeField('0x1fffffffffffff')).toEqual(9007199254740991n);
    expect(decodeField('0x0000000000000000000000000000000000000000000000000000000000000000')).toEqual(0n);
    expect(decodeField('0x0000000000000000000000000000000000000000000000000003f28cb71571c7')).toEqual(
      1111111111111111n
    );
    expect(decodeField('0xffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff')).toEqual(
      115792089237316195423570985008687907853269984665640564039457584007913129639935n
    );
  });
});
