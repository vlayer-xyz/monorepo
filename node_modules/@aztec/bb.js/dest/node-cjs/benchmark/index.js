"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.writeBenchmark = void 0;
const tslib_1 = require("tslib");
const fs = tslib_1.__importStar(require("fs"));
tslib_1.__exportStar(require("./timer.js"), exports);
const bfd = (() => {
    const bfdStr = process.env.BENCHMARK_FD;
    const bfd = bfdStr ? parseInt(bfdStr) : -1;
    if (bfd >= 0 && !fs.fstatSync(bfd)) {
        throw new Error('fd is not open. Did you redirect in your shell?');
    }
    return bfd;
})();
function writeBenchmark(name, value, labels = {}) {
    if (bfd === -1) {
        return;
    }
    const data = {
        timestamp: new Date().toISOString(),
        name,
        type: typeof value,
        value,
        ...labels,
    };
    const jsonl = JSON.stringify(data) + '\n';
    fs.writeSync(bfd, jsonl);
}
exports.writeBenchmark = writeBenchmark;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi9zcmMvYmVuY2htYXJrL2luZGV4LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFBQSwrQ0FBeUI7QUFDekIscURBQTJCO0FBRTNCLE1BQU0sR0FBRyxHQUFHLENBQUMsR0FBRyxFQUFFO0lBQ2hCLE1BQU0sTUFBTSxHQUFHLE9BQU8sQ0FBQyxHQUFHLENBQUMsWUFBWSxDQUFDO0lBQ3hDLE1BQU0sR0FBRyxHQUFHLE1BQU0sQ0FBQyxDQUFDLENBQUMsUUFBUSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztJQUMzQyxJQUFJLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsU0FBUyxDQUFDLEdBQUcsQ0FBQyxFQUFFO1FBQ2xDLE1BQU0sSUFBSSxLQUFLLENBQUMsaURBQWlELENBQUMsQ0FBQztLQUNwRTtJQUNELE9BQU8sR0FBRyxDQUFDO0FBQ2IsQ0FBQyxDQUFDLEVBQUUsQ0FBQztBQUVMLFNBQWdCLGNBQWMsQ0FBSSxJQUFZLEVBQUUsS0FBUSxFQUFFLFNBQThCLEVBQUU7SUFDeEYsSUFBSSxHQUFHLEtBQUssQ0FBQyxDQUFDLEVBQUU7UUFDZCxPQUFPO0tBQ1I7SUFDRCxNQUFNLElBQUksR0FBRztRQUNYLFNBQVMsRUFBRSxJQUFJLElBQUksRUFBRSxDQUFDLFdBQVcsRUFBRTtRQUNuQyxJQUFJO1FBQ0osSUFBSSxFQUFFLE9BQU8sS0FBSztRQUNsQixLQUFLO1FBQ0wsR0FBRyxNQUFNO0tBQ1YsQ0FBQztJQUNGLE1BQU0sS0FBSyxHQUFHLElBQUksQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDLEdBQUcsSUFBSSxDQUFDO0lBQzFDLEVBQUUsQ0FBQyxTQUFTLENBQUMsR0FBRyxFQUFFLEtBQUssQ0FBQyxDQUFDO0FBQzNCLENBQUM7QUFiRCx3Q0FhQyJ9