import { describe, expect, it } from 'vitest';
import { createMockClient } from '../../ethereum/mockClient.js';
import { getReceiptOracle } from './receiptOracle.js';
import { BYTES32_LENGTH } from './common/const.js';

describe('receiptOracle', () => {
  const OFFSETS = {
    BLOB_GAS_USED: 0,
    BLOB_GAS_PRICE: 1,
    STATUS: 2,
    STATE_ROOT: 3,
    CUMULATIVE_GAS_USED: 4,
    LOGS_BLOOM: 5
  };
  it('getReceiptOracle', async () => {
    const cancunBlockNumberInNoirFormat = '0x12884e1';
    const chainLinkTransferTxIdInNoirFormat = '0x08';
    const stateRootInNoirFormat = new Array(BYTES32_LENGTH).fill('0x00');
    const mockFilePaths = ['./fixtures/mainnet/cancun/small_block/alchemy_getTransactionReceipts_19432673.json'];
    const client = await createMockClient(mockFilePaths);

    const receiptProof = await getReceiptOracle(client, [
      [cancunBlockNumberInNoirFormat],
      [chainLinkTransferTxIdInNoirFormat]
    ]);

    expect(receiptProof[OFFSETS.BLOB_GAS_USED]).toStrictEqual('0x00');
    expect(receiptProof[OFFSETS.BLOB_GAS_PRICE]).toStrictEqual('0x00');
    expect(receiptProof[OFFSETS.STATUS]).toStrictEqual('0x01');
    expect(receiptProof[OFFSETS.STATE_ROOT]).toStrictEqual(stateRootInNoirFormat);
    expect(receiptProof[OFFSETS.CUMULATIVE_GAS_USED]).toStrictEqual('0xa17e1');
    // prettier-ignore
    expect(receiptProof[OFFSETS.LOGS_BLOOM]).toStrictEqual([
      "0x00", "0x00", "0x00", "0x00", "0x00", "0x00", "0x00", "0x00", 
      "0x00", "0x00", "0x00", "0x00", "0x00", "0x00", "0x10", "0x00",
      "0x00", "0x00", "0x00", "0x00", "0x00", "0x00", "0x00", "0x00", 
      "0x00", "0x00", "0x00", "0x00", "0x00", "0x00", "0x00", "0x00", 
      "0x00", "0x00", "0x00", "0x00", "0x00", "0x00", "0x00", "0x00", 
      "0x00", "0x00", "0x00", "0x00", "0x00", "0x00", "0x00", "0x00", 
      "0x00", "0x00", "0x00", "0x00", "0x00", "0x00", "0x00", "0x00", 
      "0x00", "0x00", "0x00", "0x00", "0x00", "0x00", "0x00", "0x00", 
      "0x00", "0x00", "0x00", "0x00", "0x00", "0x00", "0x00", "0x10", 
      "0x40", "0x00", "0x00", "0x08", "0x00", "0x00", "0x00", "0x00", 
      "0x00", "0x00", "0x00", "0x00", "0x00", "0x00", "0x00", "0x00", 
      "0x00", "0x00", "0x00", "0x00", "0x00", "0x00", "0x00", "0x00", 
      "0x00", "0x00", "0x00", "0x00", "0x00", "0x00", "0x00", "0x00", 
      "0x00", "0x00", "0x00", "0x00", "0x01", "0x00", "0x00", "0x00", 
      "0x00", "0x00", "0x00", "0x00", "0x00", "0x00", "0x00", "0x00", 
      "0x00", "0x00", "0x00", "0x10", "0x00", "0x00", "0x00", "0x00", 
      "0x00", "0x00", "0x00", "0x00", "0x00", "0x02", "0x00", "0x00", 
      "0x00", "0x00", "0x00", "0x00", "0x00", "0x00", "0x00", "0x00", 
      "0x00", "0x00", "0x00", "0x00", "0x00", "0x00", "0x00", "0x00", 
      "0x00", "0x00", "0x00", "0x00", "0x00", "0x00", "0x00", "0x00", 
      "0x00", "0x00", "0x00", "0x00", "0x00", "0x00", "0x00", "0x00", 
      "0x00", "0x00", "0x00", "0x00", "0x00", "0x00", "0x00", "0x00", 
      "0x00", "0x00", "0x00", "0x00", "0x00", "0x00", "0x00", "0x00", 
      "0x00", "0x00", "0x00", "0x00", "0x00", "0x00", "0x00", "0x00", 
      "0x00", "0x00", "0x00", "0x02", "0x00", "0x00", "0x00", "0x40", 
      "0x00", "0x00", "0x00", "0x00", "0x00", "0x00", "0x00", "0x04", 
      "0x00", "0x00", "0x00", "0x00", "0x00", "0x00", "0x10", "0x00", 
      "0x00", "0x00", "0x00", "0x00", "0x00", "0x00", "0x00", "0x00", 
      "0x00", "0x00", "0x00", "0x00", "0x00", "0x00", "0x00", "0x00", 
      "0x00", "0x00", "0x00", "0x00", "0x00", "0x00", "0x00", "0x00", 
      "0x00", "0x00", "0x00", "0x00", "0x00", "0x00", "0x00", "0x00", 
      "0x00", "0x00", "0x00", "0x00", "0x02", "0x00", "0x00", "0x00"
    ]);
  });
});
